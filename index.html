<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
  <title>Intellifusion-Club</title>
   <link rel="shortcut icon" type="image/x-icon" id="newfavicon" href="./iface.ico">
  <link href="https://cdn.bootcss.com/twitter-bootstrap/4.1.3/css/bootstrap.min.css" rel="stylesheet">
  <style>
    /* .logo {
      position: fixed;
      left: 0;
      top: 0;
      transform: translateX(50%)
    } */

    #title h3 {
      text-align: center;

    }

    #myModal {
      top: 30%
    }

    #myModal .modal-footer,
    .modal-header {
      justify-content: center;
    }

    #myModal .modal-header {
      background: #54c0f1;
    }

    #myModal .modal-header span {
      height: 50px;
      width: 150px;
      display: inline-block;
    }
  </style>
  <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
</head>

<body class="bg-info">

  <!-- <div id="title" class="row">
    <h3 class="">云天励飞Club</h3>
  </div> -->
  <!-- <div class="row bg-danger">
    <div class="panel panel-default col-md-6 col-md-offset-6">
      <div class="panel-body">
        <button type="button" class="btn btn-info col-md-offset-1">&nbsp;&nbsp;&nbsp;&nbsp;登&nbsp;&nbsp;录&nbsp;&nbsp;&nbsp;&nbsp;</button>
        <button type="button" class="btn btn-info">&nbsp;&nbsp;&nbsp;&nbsp;注&nbsp;&nbsp;册&nbsp;&nbsp;&nbsp;&nbsp;</button>
      </div>

    </div>
    <div>
    </div>


  </div> -->

  <!-- Modal -->
  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <!-- <h4 class="modal-title" id="myModalLabel">Intellifusion-Club</h4> -->
          <span>
            <img src="./logo_new.png" class="logo" alt="">
          </span>
        </div>
        <div class="modal-body">
          <form>
            <div class="form-group">
              <label for="exampleInputEmail1">用户名</label>
              <input type="text" class="form-control" id="username" placeholder="Username">
            </div>
            <div class="form-group">
              <label for="exampleInputPassword1">密码</label>
              <input type="password" class="form-control" id="password" placeholder="Password">
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" id="if_login" class="btn btn-info col-md-offset-1">&nbsp;&nbsp;&nbsp;&nbsp;登&nbsp;&nbsp;录&nbsp;&nbsp;&nbsp;&nbsp;</button>
          <button type="button" id="if_reg" class="btn btn-info">&nbsp;&nbsp;&nbsp;&nbsp;注&nbsp;&nbsp;册&nbsp;&nbsp;&nbsp;&nbsp;</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal fade" id="sorryModal" tabindex="-1" role="dialog" aria-labelledby="sorryModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title " id="sorryModalLabel">Sorry</h4>
        </div>
        <div class="modal-body">
          ...
        </div>
      </div>
    </div>
  </div>
  <script src="https://cdn.bootcss.com/twitter-bootstrap/4.1.3/js/bootstrap.min.js"></script>
</body>
<script>
var intellifURL = "http://172.96.229.3:3001"
  $(function () {
    $("#myModal").modal({ backdrop: "static", keyboard: false });
  });
  $("#if_login").click(function () {
    let username = $("#username").val();
    let password = $("#password").val();
    let param = {
      username,
      password
    }
    if (username && password)
      ""
    else return
    console.log(param)
    $.ajax({
      url: intellifURL +"/login",
      method: "post",
      data: param,
      success: function (res) {
        console.log(res)
        window.sessionStorage.setItem("jwtToken", res.token)
      },
      error: function (err) {
        console.error(err)
      }
    })
  })

  $("#if_reg").click(function () {
    let username = $("#username").val();
    let password = $("#password").val();
    let param = {
      username,
      password
    };
    let token = "";
    if (username && password)
      ""
    else return
    console.log(param)
    if (window.sessionStorage.getItem("jwtToken"))
      token = window.sessionStorage.getItem("jwtToken")
    else return
    $.ajax({
      url: intellifURL +"/testjwt",
      method: "get",
      // beforeSend:  function (xhr)  {
      //                       xhr.setRequestHeader("authorization",  "Bearer "+ token);
      //                 },
      headers: {
        'authorization': 'Bearer ' + token,
        // 'Content-Type' : 'application/json;charset=utf-8'
      },
      data: param,
      success: function (res) {
        console.log(res)
      },
      error: function (err) {
        SorryModal(err.statusText)
        console.error(err)
      }
    })
  })

  function SorryModal(text){
    $("#sorryModal .modal-body").html(text)
    $("#sorryModal").modal();
  }
</script>

</html>